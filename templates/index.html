<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Carga de Novedades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 24px; }
    .card { border-radius: 12px; }
    .required::after { content: " *"; color: #dc3545; }
  </style>
</head>
<body>
<div class="container">
  <h1 class="mb-3">Carga de Novedades</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  {% endwith %}

  <form action="{{ url_for('enviar') }}" method="post" id="formNovedad" novalidate>
    <!-- Bloque 1: Datos del empleado -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title mb-3">Datos del empleado</h5>
        <div class="row g-3">
          <div class="col-md-2">
            <label class="form-label">Legajo</label>
            <input type="text" name="legajo" class="form-control" placeholder="Opcional">
          </div>
          <div class="col-md-4">
            <label class="form-label required">Nombre y apellido</label>
            <input type="text" name="nombre" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label class="form-label required">Tipo de empleado</label>
            <select name="tipo_empleado" class="form-select" required>
              <option value="">Seleccionar...</option>
              <option>Docente</option>
              <option>No Docente</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label required">Tipo de novedad</label>
            <select name="tipo_novedad" id="tipo_novedad" class="form-select" required>
              <option value="">Seleccionar...</option>
              <option>Alta</option>
              <option>Baja</option>
              <option>Reemplazo</option>
              <option>Otros</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Bloque 2: Detalles según novedad -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title mb-3">Detalles de la novedad</h5>

        <!-- ALTA (y también Reemplazo si persona NO trabaja) -->
        <div id="altaFields" class="d-none">
          <h6 class="mb-2">Datos personales</h6>
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label class="form-label">Fecha de nacimiento</label>
              <input type="date" name="fecha_nacimiento" class="form-control">
            </div>
            <div class="col-md-2">
              <label class="form-label">DNI</label>
              <input type="text" name="dni" class="form-control" placeholder="Sólo números">
            </div>
            <div class="col-md-3">
              <label class="form-label">CUIL</label>
              <input type="text" name="cuil" class="form-control" placeholder="Ej: 20-12345678-3">
            </div>
            <div class="col-md-4">
              <label class="form-label">Domicilio</label>
              <input type="text" name="domicilio" class="form-control">
            </div>
            <div class="col-md-4">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control">
            </div>
          </div>

          <h6 class="mb-2">Datos laborales</h6>
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label class="form-label">Subvencionado</label>
              <select name="subvencionado" class="form-select">
                <option value="">--</option>
                <option>Si</option>
                <option>No</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Trabaja en otra institución</label>
              <select name="trabaja_otra_institucion" class="form-select">
                <option value="">--</option>
                <option>Si</option>
                <option>No</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Horas cátedras</label>
              <input type="number" step="0.5" min="0" name="horas_catedras" class="form-control" placeholder="Ej: 10">
            </div>
            <div class="col-md-3">
              <label class="form-label">Asig. familiares</label>
              <select name="asignaciones_familiares" class="form-select">
                <option value="">--</option>
                <option>Si</option>
                <option>No</option>
              </select>
            </div>
            <div class="col-md-1">
              <label class="form-label">Hijos</label>
              <input type="number" min="0" name="cantidad_hijos" class="form-control">
            </div>
          </div>

          <h6 class="mb-2">Datos del alta</h6>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label required" id="label_nivel">Nivel</label>
              <select name="nivel" id="nivel" class="form-select">
                <option value="">Seleccionar...</option>
                <option>Inicial</option>
                <option>Primario</option>
                <option>Secundario</option>
                <option>Terciario</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label required" id="label_fecha_alta">Fecha de alta</label>
              <input type="date" name="fecha_alta" id="fecha_alta" class="form-control">
            </div>
            <div class="col-md-4">
              <label class="form-label required" id="label_cargo">Cargo</label>
              <select name="cargo" id="cargo" class="form-select">
                <option value="">Seleccionar...</option>
                <option>Maestra/o de Grado</option>
                <option>Maestro Especial</option>
                <option>Profesor</option>
                <option>Directivo</option>
                <option>Preceptor</option>
              </select>
            </div>
          </div>
          <hr class="my-3">
        </div>

        <!-- REEMPLAZO -->
        <div id="reemplazoFields" class="d-none">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label required">¿Ya trabaja en el colegio?</label>
              <select name="reemplazo_persona_ya_trabaja" id="yaTrabaja" class="form-select">
                <option value="">Seleccionar...</option>
                <option>Si</option>
                <option>No</option>
              </select>
            </div>
          </div>

          <!-- Sub-bloque cuando SÍ trabaja -->
          <div id="reemplazoYaTrabajaDetalle" class="mt-3 d-none">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required">Cargo que cubre</label>
                <input type="text" name="reemplazo_cargo_que_cubre" class="form-control">
              </div>
              <div class="col-md-3">
                <label class="form-label required">Inicio reemplazo</label>
                <input type="date" name="fecha_inicio_reemplazo" class="form-control">
              </div>
              <div class="col-md-3">
                <label class="form-label required">Fin reemplazo</label>
                <input type="date" name="fecha_fin_reemplazo" class="form-control">
              </div>
            </div>
            <hr class="my-3">
          </div>

          <!-- Sub-bloque cuando NO trabaja (equivale a ALTA) -->
          <div id="reemplazoNoTrabajaDetalle" class="mt-3 d-none">
            <div class="alert alert-info">
              Este reemplazo corresponde a una <strong>persona nueva</strong>. Completá los campos de <em>Alta</em>.
            </div>
          </div>
        </div>

        <!-- BAJA -->
        <div id="bajaFields" class="d-none">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label required">Fecha de baja</label>
              <input type="date" name="fecha_baja" id="fecha_baja" class="form-control">
            </div>
            <div class="col-md-3">
              <label class="form-label required">Motivo</label>
              <select name="motivo_baja" id="motivo_baja" class="form-select">
                <option value="">Seleccionar...</option>
                <option>Jubilación</option>
                <option>Renuncia</option>
                <option>Despido</option>
              </select>
            </div>
          </div>
        </div>

        <!-- OTROS -->
        <div id="otrosFields" class="d-none">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label required">Tipo</label>
              <select name="tipo_otro" id="tipo_otro" class="form-select">
                <option value="">Seleccionar...</option>
                <option>Anticipo</option>
                <option>Inasistencia</option>
                <option>Licencia sin goce</option>
              </select>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Bloque 3: Extras y observaciones -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title mb-3">Información adicional</h5>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Cargos actuales</label>
            <input type="text" name="cargos_actuales" class="form-control">
          </div>
          <div class="col-md-3">
            <label class="form-label">Tipo de movimiento</label>
            <select name="tipo_movimiento" class="form-select">
              <option value="">--</option>
              <option>Alta</option>
              <option>Baja</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subvención (texto)</label>
            <input type="text" name="subvencion" class="form-control" placeholder="Ej: Código 600 / F">
          </div>
          <div class="col-md-2">
            <label class="form-label">Código</label>
            <input type="text" name="codigo" class="form-control" placeholder="Ej: F31">
          </div>
          <div class="col-12">
            <label class="form-label">Observaciones</label>
            <textarea name="observaciones" class="form-control" rows="2"></textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary">Guardar novedad</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('ver') }}">Ver novedades cargadas</a>
      <a class="btn btn-outline-primary" href="{{ url_for('descargar') }}">Descargar CSV</a>
    </div>
  </form>
</div>

<script>
  const tipoNovedad = document.getElementById('tipo_novedad');
  const alta = document.getElementById('altaFields');
  const baja = document.getElementById('bajaFields');
  const reemplazo = document.getElementById('reemplazoFields');
  const otros = document.getElementById('otrosFields');

  const yaTrabaja = document.getElementById('yaTrabaja');
  const repSi = document.getElementById('reemplazoYaTrabajaDetalle');
  const repNo = document.getElementById('reemplazoNoTrabajaDetalle');

  const nivel = document.getElementById('nivel');
  const fechaAlta = document.getElementById('fecha_alta');
  const cargo = document.getElementById('cargo');

  const fechaBaja = document.getElementById('fecha_baja');
  const motivoBaja = document.getElementById('motivo_baja');
  const tipoOtro = document.getElementById('tipo_otro');

  function clearRequired() {
    [nivel, fechaAlta, cargo, fechaBaja, motivoBaja, tipoOtro]
      .forEach(el => el && el.removeAttribute('required'));
  }

  function hideAll() {
    alta.classList.add('d-none');
    baja.classList.add('d-none');
    reemplazo.classList.add('d-none');
    otros.classList.add('d-none');
  }

  function onTipoChange() {
    hideAll();
    clearRequired();

    const v = tipoNovedad.value;

    if (v === 'Alta') {
      alta.classList.remove('d-none');
      // requeridos mínimos para Alta
      nivel.setAttribute('required', 'required');
      fechaAlta.setAttribute('required', 'required');
      cargo.setAttribute('required', 'required');
    } else if (v === 'Baja') {
      baja.classList.remove('d-none');
      fechaBaja.setAttribute('required', 'required');
      motivoBaja.setAttribute('required', 'required');
    } else if (v === 'Reemplazo') {
      reemplazo.classList.remove('d-none');
      // por defecto oculto sub-bloques
      repSi.classList.add('d-none');
      repNo.classList.add('d-none');
    } else if (v === 'Otros') {
      otros.classList.remove('d-none');
      tipoOtro.setAttribute('required', 'required');
    }
  }

  function onYaTrabajaChange() {
    if (!yaTrabaja) return;
    const val = yaTrabaja.value;
    if (val === 'Si') {
      repSi.classList.remove('d-none');
      repNo.classList.add('d-none');
      // En este caso NO exigimos los campos de Alta
      nivel.removeAttribute('required');
      fechaAlta.removeAttribute('required');
      cargo.removeAttribute('required');
    } else if (val === 'No') {
      repSi.classList.add('d-none');
      repNo.classList.remove('d-none');
      // Equivale a ALTA: exigimos campos de Alta
      nivel.setAttribute('required', 'required');
      fechaAlta.setAttribute('required', 'required');
      cargo.setAttribute('required', 'required');
      // Y mostramos la sección de Alta si no está visible
      alta.classList.remove('d-none');
    } else {
      repSi.classList.add('d-none');
      repNo.classList.add('d-none');
    }
  }

  tipoNovedad.addEventListener('change', onTipoChange);
  if (yaTrabaja) yaTrabaja.addEventListener('change', onYaTrabajaChange);

  // Inicializar estado
  onTipoChange();
</script>
</body>
</html>



